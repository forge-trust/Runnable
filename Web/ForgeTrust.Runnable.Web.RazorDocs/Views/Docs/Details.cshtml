@attribute [System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
@model ForgeTrust.Runnable.Web.RazorDocs.Models.DocNode
@{
    ViewData["Title"] = Model.Title;
    var isCSharpApiDoc = Model.Path.EndsWith(".cs", StringComparison.OrdinalIgnoreCase);
    var normalizedPath = Model.Path.Trim().Trim('/');
    var isNamespacePath = normalizedPath.Equals("Namespaces", StringComparison.OrdinalIgnoreCase)
                          || normalizedPath.StartsWith("Namespaces/", StringComparison.OrdinalIgnoreCase);
    var breadcrumbs = new List<(string Label, string? Href)>();

    if (isNamespacePath)
    {
        breadcrumbs.Add(("Namespaces", "/docs/Namespaces.html"));

        if (normalizedPath.StartsWith("Namespaces/", StringComparison.OrdinalIgnoreCase))
        {
            var fullNamespace = normalizedPath["Namespaces/".Length..];
            var parts = fullNamespace.Split('.', StringSplitOptions.RemoveEmptyEntries);
            for (var i = 0; i < parts.Length; i++)
            {
                var prefix = string.Join(".", parts.Take(i + 1));
                breadcrumbs.Add((parts[i], $"/docs/Namespaces/{prefix}.html"));
            }
        }
    }
    else
    {
        var segments = normalizedPath.Split('/', StringSplitOptions.RemoveEmptyEntries);
        foreach (var segment in segments)
        {
            breadcrumbs.Add((segment, null));
        }
    }
}

<header class="@(isCSharpApiDoc ? "mb-5" : "mb-8")">
    <nav aria-label="Breadcrumb" class="flex flex-wrap items-center gap-1 text-xs font-mono text-slate-500 mb-3">
        @for (var i = 0; i < breadcrumbs.Count; i++)
        {
            var crumb = breadcrumbs[i];
            var isLast = i == breadcrumbs.Count - 1;

            if (isLast || string.IsNullOrWhiteSpace(crumb.Href))
            {
                <span class="inline-flex max-w-full overflow-x-auto px-2 py-0.5 rounded bg-slate-800 border border-slate-700 whitespace-nowrap">@crumb.Label</span>
            }
            else
            {
                <a href="@crumb.Href"
                   data-turbo-frame="doc-content"
                   data-turbo-action="advance"
                   class="px-1 text-slate-400 hover:text-cyan-400 transition-colors">@crumb.Label</a>
                <span class="text-slate-600">/</span>
            }
        }
    </nav>
    @if (!isCSharpApiDoc)
    {
        <h1 class="text-3xl font-bold text-white tracking-tight">@Model.Title</h1>
    }
</header>

<div class="docs-content">
    @* Safe: Content is sanitized by DocAggregator before caching. *@
    @Html.Raw(Model.Content)
</div>
